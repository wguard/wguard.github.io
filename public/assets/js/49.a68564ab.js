(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{510:function(s,e,n){"use strict";n.r(e);var t=n(1),a=Object(t.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h3",{attrs:{id:"客户端环境配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#客户端环境配置"}},[s._v("#")]),s._v(" 客户端环境配置")]),s._v(" "),e("p",[s._v("以windows客户端环境为例，MacOS环境需要参考Windows环境的指引做适当的调整。")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("安装git命令行工具：https://git-scm.com/downloads")])]),s._v(" "),e("li",[e("p",[s._v("安装python")]),s._v(" "),e("p",[s._v("下载： https://www.python.org/downloads/")]),s._v(" "),e("p",[s._v("安装的过程中可以选择把 python.exe的路径加入到Path中。")]),s._v(" "),e("p",[s._v("安装完成后，新开一个command, 执行python命令，检查否能正常进入到python交互式命令行模式。")])]),s._v(" "),e("li",[e("p",[s._v("安装git-review 命令行工具:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("pip install git-review\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("安装完成后检查是否能正常启动：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("$ git review -h\nusage: git review [OPTIONS] ... [BRANCH]\n\nA git command for submitting branches to Gerrit.\n......\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])])])]),s._v(" "),e("h3",{attrs:{id:"账号注册"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#账号注册"}},[s._v("#")]),s._v(" 账号注册")]),s._v(" "),e("p",[s._v("访问"),e("code",[s._v("http://192.168.1.71:8080/static/index.html#/login")]),s._v(" 使用个人对应的公司邮箱注册，注册好后联系bingma同步用户。")]),s._v(" "),e("p",[s._v("备注：注册的时候需要使用的是完整的email地址，比如：zhangsan@longersec.com, 登录内部系统使用的实际的账号是：zhangsan")]),s._v(" "),e("h3",{attrs:{id:"登录gerrit"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#登录gerrit"}},[s._v("#")]),s._v(" 登录gerrit")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("修改 hosts文件(C:\\Windows\\System32\\drivers\\etc\\hosts)\n新增一行配置：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("192.168.1.41 git.longersec.com\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("使用注册账号登录gerrit, 登录地址："),e("code",[s._v("https://git.longersec.com:8443/")])])])]),s._v(" "),e("h3",{attrs:{id:"登录后设置-gerrit"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#登录后设置-gerrit"}},[s._v("#")]),s._v(" 登录后设置 gerrit")]),s._v(" "),e("ul",[e("li",[e("p",[s._v("配置ssh pub key")]),s._v(" "),e("ul",[e("li",[s._v("个人设置（settings）->SSH Keys, 粘贴ssh pub key的内容")])])]),s._v(" "),e("li",[e("p",[s._v("配置ssh config")]),s._v(" "),e("p",[s._v("ssh config 文件位于用户的home目录，比如：C:\\Users\\ponytp\\.ssh\\config")]),s._v(" "),e("p",[s._v("在config file增加下面的配置项（其中 IdentityFile 替换成自己的 ssh private key路径）：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("Host 192.168.1.41\n  IdentityFile C:\\\\Users\\\\ponytp\\\\.ssh\\\\id_rsa_2048_ls_dev\n  \nHost git.longersec.com\n  IdentityFile C:\\\\Users\\\\ponytp\\\\.ssh\\\\id_rsa_2048_ls_dev\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("设置go env(前端开发同学不用配置)")]),s._v(" "),e("p",[s._v("在命令行下执行下列命令")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("go env -w GONOPROXY=git.longersec.com\ngo env -w GOPRIVATE=git.longersec.com\ngo env -w GOPROXY=https://goproxy.cn,direct\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("尝试clone 代码到本地")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("git clone ssh://username@git.longersec.com:29418/common.git\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("注意，使用ssh ,不用使用 http/https 方式，username替换成自己的gerrit用户名")])]),s._v(" "),e("li",[e("p",[s._v("初始化本地仓库的review 信息")]),s._v(" "),e("p",[s._v("在本地project 目录下，执行 git review -s")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("$ git review -s\nssh://ponytp@git.longersec.com:29418/common.git did not work. Description: ponytp@git.longersec.com: Permission denied (publickey).\nfatal: Could not read from remote repository.  (默认情况会使用本机的登录名来连接gerrit,会产生错误，忽略即可)\n\nPlease make sure you have the correct access rights\nand the repository exists.\nCould not connect to gerrit.\nEnter your gerrit username: bingma (这里手工输入gerrit的正确用户名)\nTrying again with ssh://bingma@git.longersec.com:29418/common.git\nCreating a git remote called 'gerrit' that maps to:\n        ssh://bingma@git.longersec.com:29418/common.git\n\nThis repository is now set up for use with git-review. You can set the\ndefault username for future repositories with:\n  git config --global --add gitreview.username \"bingma\"\n\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br")])]),e("p",[s._v("也可以设置全局的gitreview.usernam配置:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('git config --global --add gitreview.username "bingma"\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])]),s._v(" "),e("li",[e("p",[s._v("提交代码")]),s._v(" "),e("p",[s._v("修改代码后commit（和正常的git操作一致，但不要执行git push） 然后执行 "),e("code",[s._v("git review")]),s._v(" 提交代码:")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('$ git status\nChanges not staged for commit:\n  (use "git add/rm <file>..." to update what will be committed)\n  (use "git restore <file>..." to discard changes in working directory)\n        deleted:    cmd/bh_backend/config.go\n        modified:   cmd/bh_backend/main.go\n\n$ git add .\n\n$ git commit -m "move Config to main.go"\n[master 38f82c4] move Config to main.go\n 3 files changed, 18 insertions(+), 9 deletions(-)\n create mode 100644 cmd/bh_backend/bh_backend.log\n delete mode 100644 cmd/bh_backend/config.go\n\n$ git review\nremote:\nremote: Processing changes: refs: 1, new: 1\nremote: Processing changes: refs: 1, new: 1, done\nremote:\nremote: SUCCESS\nremote:\nremote:   https://git.longersec.com:8443/c/backend/+/61 move Config to main.go [NEW]\nremote:\nTo ssh://git.longersec.com:29418/backend.git\n * [new branch]      HEAD -> refs/for/master\n\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br")])]),e("p",[s._v("代码提交后，在 gerrit --\x3e changes --\x3e open下面会出现一个新的提交，这个提交需要评审后才能合入到代码仓库。")])]),s._v(" "),e("li",[e("p",[s._v("code review")]),s._v(" "),e("p",[s._v("通知评审人，对提交做评审")])])]),s._v(" "),e("p",[s._v("type ParamTestConnection struct {")]),s._v(" "),e("p",[s._v("​    DeviceId  int64 "),e("code",[s._v('valid:"id,required"')])]),s._v(" "),e("p",[s._v("​    AccountId int64 "),e("code",[s._v('valid:"id,required"')])]),s._v(" "),e("p",[s._v("}")]),s._v(" "),e("p",[s._v("func TestConnection(sess *session.Session, param *dto.ParamTestConnection) {")]),s._v(" "),e("p",[s._v('​    logger.Debug("in TestConnection")')]),s._v(" "),e("p",[s._v("​    dbs := GetDBSession()")]),s._v(" "),e("p",[s._v("​    account, err := db.LoadOne[model.Account](dbs, t.DeviceAccount, param.AccountId)")]),s._v(" "),e("p",[s._v("​    if err != nil {")]),s._v(" "),e("p",[s._v("​        return nil, err")]),s._v(" "),e("p",[s._v("​    }")]),s._v(" "),e("p",[s._v('​    net.DialTimeout("tcp", "111", time.Duration(timeout)*time.Second)')]),s._v(" "),e("p",[s._v("}")])])}),[],!1,null,null,null);e.default=a.exports}}]);